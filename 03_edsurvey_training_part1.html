<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Using R and Generative AI for NAEP Data Analysis</title>
    <meta charset="utf-8" />
    <meta name="author" content="EdSurvey Team" />
    <script src="libs/header-attrs-2.25/header-attrs.js"></script>
    <link rel="stylesheet" href="naep-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


class: inverse, title-slide

&lt;hr&gt;

The R EdSurvey Package
========================================================

## Using R and Generative AI for NAEP Data Analysis: Part One


&lt;hr&gt;
&lt;br&gt;

**Presenters**: Sinan Yavuz, Ting Zhang, Paul Bailey, Blue Webb and Emmanuel Sikali

_April 2024_

.logo[
&lt;img src="presentationFigures/naepLogo.png" width="80%" height="80%" /&gt;
]

---
Goal
========================================================
&lt;br&gt;
## Provide participants with an overview of the methods used to analyze large-scale assessment data using the R package `EdSurvey` and generative AI chatbot-EdSurveyGPT

---

Outline of EdSurvey Session: Part One
========================================================

- EdSurveyGPT
- Why R and Why EdSurvey
- Get to Know the R Environment
- Data Processing
- Meet Your Data (`searchSDF`, `levelSDF`, `showCodebook`)
- Data Manipulation

---
class: inverse, section-slide

EdSurveyGPT
========================================================
&lt;hr class="sectionSlide"&gt;
.logoSection[
&lt;img src="presentationFigures/naepLogo.png" width="40%" height="40%" /&gt;
]


---
class: inverse, section-slide

Why R and Why EdSurvey
========================================================
&lt;hr class="sectionSlide"&gt;
.logoSection[
&lt;img src="presentationFigures/naepLogo.png" width="80%" height="80%" /&gt;
]

---

Why R?
========================================================



1. **Free:** Users can legally use and edit R package code

2. **Extensible:** Large variety of contributed packages that expand its functionality

3. **Transparent:** Codes are open, so it provides full transparency in its mechanism and the formulas behind each functionality

4. **Reproducible:** Automated data analysis

5. **Designed by and for researchers:** Robust ecosystem to translate data into analyses, visualizations, and summary reports with one software

---

Why EdSurvey?
========================================================
  


1. **One-stop shop**: For data downloading, processing, manipulation, and analysis of survey data.

2. **Automated**: Weights and complex sampling design calculations are automated following standard NCES methodology.

3. **Simple**: For example a regression with 62 replicate weights and 20 plausible values requires only a few lines of code.

4. **Flexible**: You can use functions that rely on `EdSurvey` methods or get the data and use traditional `R`.

5. **Expansible**: Has the capacity to expand functions and data supports to meet the needs of analysts of various levels of expertise

6. **Minimizes memory footprint**: by only reading in required data.

---

class: explainerA

Basic R Infrastructure
========================================================

---

class: explainerB

Basic R Infrastructure
========================================================

---

class: explainerC

Basic R Infrastructure
========================================================

---

class: explainerD

Basic R Infrastructure
========================================================

---
class: inverse, section-slide

Get to Know the R Environment
========================================================
&lt;hr class="sectionSlide"&gt;
.logoSection[
&lt;img src="presentationFigures/naepLogo.png" width="80%" height="80%" /&gt;
]

---

RStudio
========================================================

- If it's your first time using R, note that it will ask you to select a mirror
  - Try the first one on the list: "0-cloud"


&lt;img src="presentationFigures/rstudio.png" width="80%" height="80%" /&gt;

---

Using R Scripts
========================================================

## Open script


&lt;img src="presentationFigures/rstudioScript.png" width="1717" /&gt;

---

Notes About Using R
========================================================

- Comment character is a hash

```r
# this line is not executed
```

- Variables are assigned with an equals or `&lt;-`

```r
x &lt;- 12
x
```

```
## [1] 12
```

- In file names on Windows use a forward slash
  - `C:/`
  
- R is case sensitive!

```r
j &lt;- 12
J
```

```
## Error in eval(expr, envir, enclos): object 'J' not found
```

---

Notes About Using R
========================================================

- Any command can be input with a question mark preceding it to open the help guide


```r
?mean
```

- Use the up arrow on your keyboard to copy your previous lines of code

- Try tab completion: type "data" then hit the tab key

&lt;img src="presentationFigures/dataTab.png" width="335" /&gt;

---

Using R Functions
========================================================

- `c()` function combines values separated by a comma into a vector


```r
colors &lt;- c("red", "green", "blue")
colors
```

```
## [1] "red"   "green" "blue"
```

```r
numbers &lt;- c(1, 2, 3)
numbers
```

```
## [1] 1 2 3
```

- In the `EdSurvey` package we'll use vectors to combine the names of variables in our analyses

---

Using R Functions
========================================================

- Arguments can be explicitly or implicitly named


```r
mean(x = numbers)
```

```
## [1] 2
```

```r
mean(numbers)
```

```
## [1] 2
```

- Arguments are separated by commas

&lt;img src="presentationFigures/meanArgs2.png" width="30%" height="30%" /&gt;


---
Follow Along: R Scripts
========================================================

- Highlight and press `ctrl` + `enter` executes code to console

&lt;img src="presentationFigures/codeToConsole.png" width="515" /&gt;

Follow along in [edsurvey_training_part1.R](edsurvey_training_part1.R)

---

Installing the EdSurvey Package
========================================================

- After opening up RStudio, run the following scripts in the console to download and initialize the `EdSurvey` package:


```r
# to install the package
install.packages("EdSurvey")
```




```r
# to load the package
library(EdSurvey)
```

---

Learning EdSurvey
========================================================

- Reading vignettes provided in training materials


```r
vignette("introduction", package="EdSurvey")
```

- R help

```r
help(package = "EdSurvey")
```

- [EdSurvey User Guide](https://naep-research.airprojects.org/Portals/0/EdSurvey_A_Users_Guide/_book/index.html)

- [EdSurvey Website](https://www.air.org/edsurvey-installation-and-use)

- [EdSurvey Github](https://github.com/American-Institutes-for-Research/EdSurvey)

- [EdSurvey Data Training Workshops](http://naep-research.airprojects.org/Opportunities/Training)

---

Think, Pair, Share: R Functions
========================================================

What are the arguments of the function `readNAEP()`? What are some examples of acceptable values for each argument?

---

Think, Pair, Share: R Functions
========================================================

`readNAEP()` arguments from R documentation (*type `?readNAEP` in the console*)


&lt;img src="presentationFigures/readNAEP.png" width="70%" height="70%" /&gt;

---

class: inverse, section-slide

Data Processing
========================================================
&lt;hr class="sectionSlide"&gt;
.logoSection[
&lt;img src="presentationFigures/naepLogo.png" width="80%" height="80%" /&gt;
]

---

class: EdSurveyWorkflowBlank

Data Processing: EdSurvey Workflow
========================================================

---

Data Processing: EdSurvey Workflow
========================================================

&lt;img src="presentationFigures/workflow1.png" width="60%" height="60%" /&gt;

- Install R and EdSurvey
- Download and read in data

**Example functions**:
 - `readTIMSS`, `readPIRLS`, `readPISA`, `readTALIS`
 - `downloadTIMSS`, `downloadPIRLS`, `downloadPISA`, `downloadTALIS`

---

Data Processing: EdSurvey Workflow
========================================================

&lt;img src="presentationFigures/workflow2.png" width="60%" height="60%" /&gt;

- **Explore**: Explore the codebook, see the variables with plausible values, see weights
- **Search**: Search variables
- **Expand**: See variable levels, tabulate response percentages, see assessment scores by response category, summarize continuous variables

**Example functions**:
- `showCodebook`, `showPlausibleValues`, `showWeights`
- `searchSDF`, `levelsSDF`
- `summary2`, `edsurveyTable`


---

Data Processing: EdSurvey Workflow
========================================================

&lt;img src="presentationFigures/workflow3.png" width="60%" height="60%" /&gt;

In **EdSurvey**: Clean and manipulate data with built-in subset and recode features

In **R**: Extract and manipulate data as a data frame (for experienced users)

**Example functions**:
- `subset`
- recode with `ifelse`
- `getData`, `rebindAttributes`

---

Data Processing: EdSurvey Workflow
========================================================

&lt;img src="presentationFigures/workflow4.png" width="60%" height="60%" /&gt;

- **Run analyses** such as regression analysis, logit analysis, mixed models, show gaps, calculate achievement levels, correlate variables, calculate percentiles.

**Example functions**:
- `achievementLevels`, `percentile`
- `cor.sdf`
- `gap`
- `lm.sdf`, `glm.sdf`
- `mvrlm.sdf`, `mixed.sdf`

---


Data Processing: EdSurvey Workflow
========================================================

&lt;img src="presentationFigures/EdSurveyWorkflowFull.png" width="50%" height="50%" /&gt;

- Related documentation: [EdSurvey User Guide](https://naep-research.airprojects.org/Portals/0/EdSurvey_A_Users_Guide/_book/index.html)

---

Data Processing: Reading NAEP Data
========================================================

- First, read in the publicly available NAEP data from the `NAEPprimer` package. `NAEPprimer` is a mini sample of the 2005 NAEP mathematics Grade 8 assessment for public schools.


```r
sdf &lt;- readNAEP(system.file("extdata/data", "M36NT2PM.dat", package = "NAEPprimer"))
```

&lt;img src="presentationFigures/sdf.png" width="75%" height="75%" /&gt;

---

Data Processing: Reading NAEP Data
========================================================

- Can also read in other restricted-use NAEP data by naming the file location


```r
math19 &lt;- readNAEP("//path_to_directory/Data/M50NT2AT.dat")
```

- The first character indicates the subject: `M` (Math)
- The second and third characters indicate the NAEP year: `50` (2019 – 1969 = 50)
- The fourth character indicates the component: `N` (National)
- The fifth character indicates the type of data: `T` (Student)
- The sixth character indicates the grade cohort: `2` (8th)
- The seventh and eighth characters indicate the sample: `AT` (Main NAEP)

---

Data Processing: Reading NAEP Data
========================================================

NOTE: The data file requires its intact data folder directory in order to be read in correctly. It must contain both the student- and school-level files to merge data.

&lt;img src="presentationFigures/dataPathway2.png" width="60%" height="60%" /&gt;

---

class: inverse, section-slide

Meet Your Data
========================================================
&lt;hr class="sectionSlide"&gt;
.logoSection[
&lt;img src="presentationFigures/naepLogo.png" width="80%" height="80%" /&gt;
]

---

Quick Terminology Notes
========================================================

The `edsurvey.data.frame` class stores information about survey data via a data connection, which allows for:
  - correct calculation of relevant statistics.
  - limited working memory usage.

&lt;br&gt;

**`_____SDF`**

The EdSurvey package uses the acronym `SDF` in the names of several functions to signify their relationship to **S**urvey **D**ata **F**rames.

---

Meet Your Data: print
========================================================

**`print()`**

- The `print` function returns detailed data file information:

.codeScroll20[

```r
print(sdf)
```

```
## edsurvey.data.frame for 2005 NAEP National - Primer (Mathematics; Grade 8) in USA
## Dimensions: 17606 rows and 303 columns.
## 
## There is 1 full sample weight in this edsurvey.data.frame:
##   'origwt' with 62 JK replicate weights (the default).
## 
## 
## There are 6 subject scale(s) or subscale(s) in this edsurvey.data.frame:
## 'num_oper' subject scale or subscale with 5 plausible values.
## 
## 'measurement' subject scale or subscale with 5 plausible values.
## 
## 'geometry' subject scale or subscale with 5 plausible values.
## 
## 'data_anal_prob' subject scale or subscale with 5 plausible values.
## 
## 'algebra' subject scale or subscale with 5 plausible values.
## 
## 'composite' subject scale or subscale with 5 plausible values (the default).
## 
## 
## Omitted Levels: 'Multiple', 'NA', and 'Omitted'
## 
## Default Conditions:
## tolower(rptsamp) == "reporting sample"
## Achievement Levels:
## Mathematics:
## Basic: 262.00
## Proficient: 299.00
## Advanced: 333.00
```
]

&lt;br&gt;

---

Meet Your Data: colnames
========================================================

**`colnames()`**

- Prints the names of all variables in the data:

.codeScroll20[.code60[

```r
colnames(sdf)
```

```
##   [1] "ROWID"   "year"    "cohort"  "scrpsu"  "dsex"    "iep"     "lep"     "ell3"    "sdracem" "pared"   "b003501" "b003601"
##  [13] "b013801" "b017001" "b017101" "b018101" "b018201" "b017451" "m815401" "m815501" "m815601" "m815801" "m815701" "rptsamp"
##  [25] "repgrp1" "repgrp2" "jkunit"  "origwt"  "srwt01"  "srwt02"  "srwt03"  "srwt04"  "srwt05"  "srwt06"  "srwt07"  "srwt08" 
##  [37] "srwt09"  "srwt10"  "srwt11"  "srwt12"  "srwt13"  "srwt14"  "srwt15"  "srwt16"  "srwt17"  "srwt18"  "srwt19"  "srwt20" 
##  [49] "srwt21"  "srwt22"  "srwt23"  "srwt24"  "srwt25"  "srwt26"  "srwt27"  "srwt28"  "srwt29"  "srwt30"  "srwt31"  "srwt32" 
##  [61] "srwt33"  "srwt34"  "srwt35"  "srwt36"  "srwt37"  "srwt38"  "srwt39"  "srwt40"  "srwt41"  "srwt42"  "srwt43"  "srwt44" 
##  [73] "srwt45"  "srwt46"  "srwt47"  "srwt48"  "srwt49"  "srwt50"  "srwt51"  "srwt52"  "srwt53"  "srwt54"  "srwt55"  "srwt56" 
##  [85] "srwt57"  "srwt58"  "srwt59"  "srwt60"  "srwt61"  "srwt62"  "smsrswt" "mrps11"  "mrps12"  "mrps13"  "mrps14"  "mrps15" 
##  [97] "mrps21"  "mrps22"  "mrps23"  "mrps24"  "mrps25"  "mrps31"  "mrps32"  "mrps33"  "mrps34"  "mrps35"  "mrps41"  "mrps42" 
## [109] "mrps43"  "mrps44"  "mrps45"  "mrps51"  "mrps52"  "mrps53"  "mrps54"  "mrps55"  "mrpcm1"  "mrpcm2"  "mrpcm3"  "mrpcm4" 
## [121] "mrpcm5"  "m075201" "m075401" "m075601" "m019901" "m066201" "m047301" "m046201" "m066401" "m020101" "m067401" "m086101"
## [133] "m047701" "m067301" "m048001" "m093701" "m086001" "m051901" "m076001" "m046001" "m046101" "m067701" "m046701" "m046901"
## [145] "m047201" "m046601" "m046801" "m067801" "m066601" "m067201" "m068003" "m068005" "m068008" "m068007" "m068006" "m093601"
## [157] "m053001" "m047801" "m086301" "m085701" "m085901" "m085601" "m085501" "m085801" "m019701" "m020001" "m046301" "m047001"
## [169] "m046501" "m066501" "m047101" "m066301" "m067901" "m019601" "m051501" "m047901" "m053101" "m143601" "m143701" "m143801"
## [181] "m143901" "m144001" "m144101" "m144201" "m144301" "m144401" "m144501" "m144601" "m144701" "m144801" "m144901" "m145001"
## [193] "m145101" "m013431" "m0757cl" "m013131" "m091701" "m072801" "m091501" "m091601" "m073501" "m052401" "m075301" "m072901"
## [205] "m013631" "m075801" "m013731" "m013531" "m051801" "m093401" "m093801" "m142001" "m142101" "m142201" "m142301" "m142401"
## [217] "m142501" "m142601" "m142701" "m142801" "m142901" "m143001" "m143101" "m143201" "m143301" "m143401" "m143501" "m105601"
## [229] "m105801" "m105901" "m106001" "m106101" "m106201" "m106301" "m106401" "m106501" "m106601" "m106701" "m106801" "m106901"
## [241] "m107001" "m107101" "m107201" "m107401" "m107501" "m107601" "m109801" "m110001" "m110101" "m110201" "m110301" "m110401"
## [253] "m110501" "m110601" "m110701" "m110801" "m110901" "m111001" "m111201" "m111301" "m111401" "m111501" "m111601" "m111801"
## [265] "yrsexp"  "yrsmath" "t089401" "t088001" "t090801" "t090802" "t090803" "t090804" "t090805" "t090806" "t087501" "t088301"
## [277] "t088401" "t088501" "t088602" "t088603" "t088801" "t088803" "t088804" "t088805" "t091502" "t091503" "t091504" "c052801"
## [289] "c052802" "c052804" "c052805" "c052806" "c052807" "c052808" "c052701" "c046501" "c044006" "c044007" "c052901" "c053001"
## [301] "c053101" "sscrpsu" "c052601"
```
]]

---

Meet Your Data: searchSDF
========================================================

**`searchSDF()`** searches the survey data frame by character strings:


```r
searchSDF("education", data = sdf)
```

```
##   variableName                                      Labels fileFormat
## 1        pared Parental education level (from 2 questions)    Student
## 2      b003501                    Mother's education level    Student
## 3      b003601                    Father's education level    Student
## 4      c044007                Percent in special education    Student
```

- Add argument `levels = TRUE` to return variable levels:

.codeScroll10[

```r
searchSDF("b003501", data = sdf, levels = TRUE)
```

```
## Variable: b003501
## Label: Mother's education level
## Levels (Lowest level first):
##      1. Did not finish H.S.
##      2. Graduated H.S.
##      3. Some ed after H.S.
##      5. I don't know
##      7. I Don't Know
##      8. Omitted
##      0. Multiple
```
]

- What occurs with an empty string?


```r
searchSDF("", data = sdf)
```

---

Meet Your Data: levelsSDF
========================================================

**`levelsSDF()`**

- Shows the levels of a variable:


```r
levelsSDF(varnames = "b018201", data = sdf)
```

```
## Levels for Variable 'b018201' (Lowest level first):
##     1. Never (n = 9524)
##     2. Once in a while (n = 3328)
##     3. Half the time (n = 1178)
##     4. All or most of time (n = 2133)
##     8. Omitted* (n = 741)
##     0. Multiple* (n = 11)
##     NOTE: * indicates an omitted level.
```

---

Meet Your Data: showCodebook
========================================================

**`showCodebook()`**

- Shows the levels of all variables printed to the console.  If there are lots of variables, this can be hard to read.

```r
showCodebook(data = sdf) # or showCodebook(sdf)
```
- The output can be assigned to a variable and is returned as a `data.frame`.

```r
book &lt;- showCodebook(sdf)
```
- `View()` shows a preview of a selected data set in a new 'Excel'-like tab in RStudio (*RStudio specific).

```r
View(showCodebook(sdf))
```

---


Meet Your Data: showPlausibleValues
========================================================

**`showPlausibleValues()`** prints all plausible values:

.codeScroll15[

```r
showPlausibleValues(sdf)
```

```
## There are 6 subject scale(s) or subscale(s) in this edsurvey.data.frame:
## 'num_oper' subject scale or subscale with 5 plausible values.
## 
## 'measurement' subject scale or subscale with 5 plausible values.
## 
## 'geometry' subject scale or subscale with 5 plausible values.
## 
## 'data_anal_prob' subject scale or subscale with 5 plausible values.
## 
## 'algebra' subject scale or subscale with 5 plausible values.
## 
## 'composite' subject scale or subscale with 5 plausible values (the default).
```
]

- add `verbose = TRUE` for all detail:

.codeScroll10[

```r
showPlausibleValues(sdf, verbose = TRUE)
```

```
## There are 6 subject scale(s) or subscale(s) in this edsurvey.data.frame:
## 'num_oper' subject scale or subscale with 5 plausible values.
##   The plausible value variables are: 'mrps11', 'mrps12', 'mrps13', 'mrps14', and 'mrps15'
## 
## 'measurement' subject scale or subscale with 5 plausible values.
##   The plausible value variables are: 'mrps21', 'mrps22', 'mrps23', 'mrps24', and 'mrps25'
## 
## 'geometry' subject scale or subscale with 5 plausible values.
##   The plausible value variables are: 'mrps31', 'mrps32', 'mrps33', 'mrps34', and 'mrps35'
## 
## 'data_anal_prob' subject scale or subscale with 5 plausible values.
##   The plausible value variables are: 'mrps41', 'mrps42', 'mrps43', 'mrps44', and 'mrps45'
## 
## 'algebra' subject scale or subscale with 5 plausible values.
##   The plausible value variables are: 'mrps51', 'mrps52', 'mrps53', 'mrps54', and 'mrps55'
## 
## 'composite' subject scale or subscale with 5 plausible values (the default).
##   The plausible value variables are: 'mrpcm1', 'mrpcm2', 'mrpcm3', 'mrpcm4', and 'mrpcm5'
```
]

---

Meet Your Data: showWeights
========================================================

**`showWeights()`** prints all weights:


```r
showWeights(sdf)
```

```
## There is 1 full sample weight in this edsurvey.data.frame:
##   'origwt' with 62 JK replicate weights (the default).
```

- add `verbose = TRUE` to print the complete list of jackknife replicate weights associated with each full sample weight:


```r
showWeights(sdf, verbose = TRUE)
```

```
## There is 1 full sample weight in this edsurvey.data.frame:
##   'origwt' with 62 JK replicate weights (the default).
##     Jackknife replicate weight variables associated with the full sample weight 'origwt':
##     'srwt01', 'srwt02', 'srwt03', 'srwt04', 'srwt05', 'srwt06', 'srwt07', 'srwt08', 'srwt09', 'srwt10', 'srwt11',
##     'srwt12', 'srwt13', 'srwt14', 'srwt15', 'srwt16', 'srwt17', 'srwt18', 'srwt19', 'srwt20', 'srwt21', 'srwt22',
##     'srwt23', 'srwt24', 'srwt25', 'srwt26', 'srwt27', 'srwt28', 'srwt29', 'srwt30', 'srwt31', 'srwt32', 'srwt33',
##     'srwt34', 'srwt35', 'srwt36', 'srwt37', 'srwt38', 'srwt39', 'srwt40', 'srwt41', 'srwt42', 'srwt43', 'srwt44',
##     'srwt45', 'srwt46', 'srwt47', 'srwt48', 'srwt49', 'srwt50', 'srwt51', 'srwt52', 'srwt53', 'srwt54', 'srwt55',
##     'srwt56', 'srwt57', 'srwt58', 'srwt59', 'srwt60', 'srwt61', and 'srwt62'
```

---

Meet Your Data: Omitted Levels
========================================================

- Levels of the variables that will be omitted (excluded) by default from `edsurvey.data.frame` results 
- By default, all analytical functions apply list-wise deletions for omitted levels (the default settings can be changed)

&lt;img src="presentationFigures/omittedLevels.png" width="80%" height="80%" /&gt;

---

Meet Your Data: Default Conditions
========================================================

- Special considerations for a particular `edsurvey.data.frame`
- For NAEP, this defaults the 'reporting sample,' which excludes selected students who did not respond

&lt;img src="presentationFigures/defaultConditions.png" width="80%" height="80%" /&gt;

---


Think, Pair, Share: Meet your data
========================================================
  
Explore the NAEP Primer data and discuss what subscales are available in this data set.

What are the variables related to computer usage?

Think of your research question and find the variables in the data that could support it.

---

class: inverse, section-slide

Data Manipulation
========================================================
&lt;hr class="sectionSlide"&gt;
.logoSection[
&lt;img src="presentationFigures/naepLogo.png" width="80%" height="80%" /&gt;
]


---

EdSurvey Calls Network Connection
========================================================

**Small Memory Footprint**


&lt;img src="presentationFigures/data_footprint.png" width="200%" height="200%" /&gt;
	
---

Data Manipulation: $
========================================================

* You can manipulate variables as you would with a normal data frame, with `sdf$` and assignment works as well
.codeScroll25[

```r
# table(sdf$b017451)
sdf$b017451_recode &lt;- ifelse(sdf$b017451 %in% c("Omitted",
                                                "Multiple"),
                             "Omitted or multiple",
                             as.character(sdf$b017451))
# table(sdf$b017451_recode, sdf$b017451)
```
]

---

Data Manipulation: Just Give Me the Data
========================================================

* If you want to work with a data frame, you can easily get one

```r
dat &lt;- sdf[,c("b017451", "ell3")]
```
* Get all the columns

```r
dat &lt;- sdf[,colnames(sdf)]
```


---

Data Manipulation: getData
========================================================

**`getData()`** reads in selected variables and sampling weights from the EdSurvey database and returns a `light.EdSurvey.data.frame` (a data-frame-like object) into the `.GlobalEnv` environment.

**Functionality:**

- Retrieve variables by call
- Manipulate the resulting `light.EdSurvey.data.frame`:
  - subset
  - recode
  - drop levels
- Use `EdSurvey` package functions on `light.EdSurvey.data.frames`.

- Related documentation: [EdSurvey-getData.pdf](https://www.air.org/sites/default/files/EdSurvey-getData.pdf).

---

Data Manipulation: getData
========================================================

**`getData()`**


```r
gddat &lt;- getData(sdf, varnames = c('dsex', 'sdracem', 'b018201', 'b017451',
                                   'composite', 'geometry', 'origwt'),
                 addAttributes = TRUE, dropOmittedLevels = FALSE)
```

A vector of variable names, including:

- `dsex` (Gender), `sdracem` (Race/ethnicity), `b018201` (Language other than English spoken in home) and `b017451` (Frequency of talk about studies at home)
- All plausible values associated with the `composite` scale (i.e., NAEP mathematics composite scale scores of 8th grade students) and the `geometry` subscale
- The sampling weight for this data frame: `origwt`, and its associated replicate weights


---

Data Manipulation: getData
========================================================

**`getData()`**


```r
gddat &lt;- getData(sdf, varnames = c('dsex', 'sdracem', 'b018201', 'b017451',
                                   'composite', 'geometry', 'origwt'),
              addAttributes = TRUE, dropOmittedLevels = FALSE)
```

- A few important things to note:
  - "`addAttributes = TRUE`" allows the `data.frame` to be passed to `EdSurvey` package functions
  - all of the jackknife replicates are automatically returned (`srwt01` to `srwt62`)
  - "`dropOmittedLevels = FALSE`" returns variables with special values (such as multiple entries or NAs)

---

Data Manipulation: subset
========================================================

**`subset()`** Returns only the data-matching elements from a variable.

- Subset the connection to the data for all analyses:


```r
subsetSDF &lt;- subset(gddat, dsex %in% c("Male"))
```

- As expected, the `subsetSDF` contains about half the rows of the original:


```r
dim(sdf)
```

```
## [1] 17606   304
```

```r
dim(subsetSDF)
```

```
## [1] 8486   77
```

---

class: vizExplainerD

Data Manipulation: adding dplyr
========================================================

- **`filter()`** is a dplyr function used to subset data frames. There are many other data manipulation commands in **`dplyr`**. Try **`?dplyr`** for more information. 

```r
library(dplyr)
library(tidyEdSurvey)
# with tidyEdSurvey loaded, you can just use dplyr
subsetSDF &lt;- sdf %&gt;% filter(sdracem != "White")
head(subsetSDF[,1:10], 6)
```

```
##   ROWID       b017451_recode year cohort scrpsu   dsex iep lep ell3              sdracem
## 1    16    About once a week   36 Age 13      5   Male  No Yes  Yes Asian/Pacific Island
## 2    21            Every day   36 Age 13      5   Male Yes  No   No             Hispanic
## 3    22 Once every few weeks   36 Age 13      5   Male  No  No   No Amer Ind/Alaska Natv
## 4    26 Never or hardly ever   36 Age 13      5 Female  No  No   No             Hispanic
## 5    47  2 or 3 times a week   36 Age 13     45 Female  No  No   No Asian/Pacific Island
## 6    59 Once every few weeks   36 Age 13     56 Female  No  No   No                Black
```


---

Data Manipulation: caution with attributes
========================================================

```r
showWeights(subsetSDF)
```

```
## There is 1 full sample weight in this edsurvey.data.frame:
##   'origwt' with 62 JK replicate weights (the default).
```

```r
names(attributes(subsetSDF))
```

```
##  [1] "names"                "class"                "row.names"            "userConditions"       "defaultConditions"   
##  [6] "dataList"             "weights"              "pvvars"               "subject"              "year"                
## [11] "assessmentCode"       "dataType"             "gradeLevel"           "achievementLevels"    "omittedLevels"       
## [16] "survey"               "country"              "psuVar"               "stratumVar"           "jkSumMultiplier"     
## [21] "recodes"              "dim0"                 "validateFactorLabels" "cacheDataLevelName"   "reqDecimalConversion"
## [26] "fr2Path"              "dichotParamTab"       "polyParamTab"         "adjustedData"         "testData"            
## [31] "scoreCard"            "scoreDict"            "scoreFunction"
```


---

Data Manipulation: caution with attributes
========================================================

```r
subsetSDF &lt;- sdf %&gt;% 
  filter(sdracem != "White") %&gt;%  
  rebindAttributes(sdf) # adding rebindAttributes
showWeights(subsetSDF)
```

```
## There is 1 full sample weight in this edsurvey.data.frame:
##   'origwt' with 62 JK replicate weights (the default).
```


```r
names(attributes(subsetSDF))
```

```
##  [1] "names"                "row.names"            "class"                "userConditions"       "defaultConditions"   
##  [6] "dataList"             "weights"              "pvvars"               "subject"              "year"                
## [11] "assessmentCode"       "dataType"             "gradeLevel"           "achievementLevels"    "omittedLevels"       
## [16] "survey"               "country"              "psuVar"               "stratumVar"           "jkSumMultiplier"     
## [21] "dim0"                 "validateFactorLabels" "cacheDataLevelName"   "reqDecimalConversion" "fr2Path"             
## [26] "dichotParamTab"       "polyParamTab"         "adjustedData"         "testData"             "scoreCard"           
## [31] "scoreDict"            "scoreFunction"        "cache"
```

---

Data Manipulation: caution with attributes
========================================================
- Sometimes functions from packages like `dplyr` can change a `light.edsurvey.data.frame` to a `data.frame`.

- This breaks the data frames compatibility with `EdSurvey` functions. 

- `rebindAttributes()` fixes this by re-adding `light.edsurvey.data.frame` attributes to the returned `data.frame`. 

---

Data Manipulation: recoding variables
========================================================

You can use **`recode.sdf()`** but another option is `ifelse` to recode:


```r
sdf$b017451_edited &lt;- ifelse(sdf$b017451 %in% c("Never or hardly ever", "Once every few weeks"),
                             "Infrequently",
                             sdf$b017451)
#table(sdf$b017451_edited, sdf$b017451)
```


---

Think, Pair, Share: Data Manipulation
========================================================
  
How would you recode `t091502` (and what is that variable?) or another variable of your own interest in the NAEP Primer data?

---

Data Visualization: loading ggplot
========================================================

**`install.package`** and  **`library`** ggplot2:

```r
# R code for loading ggplot2
install.packages("ggplot2") # only necessary once, or if updating
```


```r
# R code for loading ggplot2
library(ggplot2)
library(tidyEdSurvey)
```



---

Data Visualization: ggplot function
========================================================

**`ggplot(data=sdf, aes(x=b017451)) + geom_bar() + coord_flip() + labs(title = "Figure 1")`**

**Functionality**

- supply data to plot, and aesthetic mapping (axis variables and groupings)
- add layers with `+` to create different kinds of graphs or add other graph elements:
  - **`geom_bar()`**: bar charts 
  - **`geom_histogram()`**: histograms 
  - **`coord_flip()`**: flip coordinates 
  - **`labs()`**: add labels 

- Related documentation: [EdSurvey Vignette](https://www.air.org/sites/default/files/EdSurvey-EDA.pdf) or [ggplot2](https://ggplot2.tidyverse.org/)
- Note: The charts presented are all  **quick and dirty**—unless noted, they are not weighted, and in the case of plausible values, only one set is used. 

---

Data Visualization: plotting categorical
========================================================


```r
library(tidyEdSurvey)
# R code generating Figure 1
bar1 &lt;- ggplot(data=sdf, aes(x=b017451)) +
  geom_bar() +
  coord_flip() +
  labs(title = "Figure 1") 
bar1
```

&lt;img src="edsurvey_training_part1_files/figure-html/unnamed-chunk-33-1.png" style="display: block; margin: auto;" /&gt;
Note: loading `tidyEdSurvey` a few slides ago allows us to use `sdf` directly in `ggplot2` calls, without that you'll need to change the code to use `gddat`.

---

Data Visualization: catorgical by group
========================================================

```r
# R code for generating Figure 2
bar2 &lt;- ggplot(data=sdf, aes(x=b017451, fill=dsex)) +
  geom_bar(position='dodge') +
  coord_flip() +
  labs(title = "Figure 2")
bar2
```

&lt;img src="edsurvey_training_part1_files/figure-html/unnamed-chunk-34-1.png" style="display: block; margin: auto;" /&gt;


---

Data Visualization: plotting continuous
========================================================

```r
# R code for generating Figure 3
hist1 &lt;- ggplot(sdf, aes(x=mrpcm1)) +
    geom_histogram(bins=30) + # geom type changed
    labs(title = "Figure 3")
hist1
```

&lt;img src="edsurvey_training_part1_files/figure-html/unnamed-chunk-35-1.png" style="display: block; margin: auto;" /&gt;

---

Data Visualization: histogram with grouping
========================================================

```r
hist2 &lt;- ggplot(sdf, aes(x=mrpcm1, fill = dsex)) +
     geom_histogram(position="identity", alpha = 0.6, bins=30) + # alpha adjust color transparency
     labs(title = "Figure 4") + 
     scale_fill_manual(values=c("#E69F00", "#56B4E9")) # scale fill can change default colors
hist2
```

&lt;img src="edsurvey_training_part1_files/figure-html/unnamed-chunk-36-1.png" style="display: block; margin: auto;" /&gt;


---

Data Visualization: histogram with facets
========================================================


```r
ggplot(sdf, aes(x=mrpcm1)) +
     geom_histogram(position="identity", alpha = 0.6, bins=30) + # alpha adjust color transparency
     geom_vline(aes(xintercept = mean(mrpcm1)),col='red',linewidth=1) + # add mean line
     theme_minimal() + 
     labs(y = "count") + 
     facet_wrap(~ sdracem, ncol = 3 ) # great graph faceted by group 
```

&lt;img src="edsurvey_training_part1_files/figure-html/unnamed-chunk-37-1.png" style="display: block; margin: auto;" /&gt;

---

Data Visualization: box-plots
========================================================

```r
# R code for generating Figure 4
box1 &lt;- ggplot(sdf, aes(x=sdracem, y=mrpcm1)) + 
  geom_boxplot() +
  stat_summary(fun=mean, geom="point", shape=23, size=4) + # transorm data in function
  coord_flip() +
  labs(title = "Figure 4") 
box1
```

&lt;img src="edsurvey_training_part1_files/figure-html/unnamed-chunk-38-1.png" style="display: block; margin: auto;" /&gt;

---

Data Visualization: box-plots
========================================================


```r
# R code for generating Figure 4
box1 &lt;- ggplot(sdf, aes(x=sdracem, y=mrpcm1), fill = dsex) + 
  geom_boxplot(aes(fill = dsex)) +
  stat_summary(fun=mean, geom="point", shape=23, size=4) + # transorm data in function
  coord_flip() +
  labs(title = "Figure 4") 
box1
```

&lt;img src="edsurvey_training_part1_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
